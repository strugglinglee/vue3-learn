var e={d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};e.d(n,{ri:()=>ge,Us:()=>se,FN:()=>J,h:()=>y,qj:()=>V,iH:()=>X,Y1:()=>Q});var t,o={};e.r(o),e.d(o,{createApp:()=>ge,createRenderer:()=>se,getCurrentInstance:()=>J,h:()=>y,reactive:()=>V,ref:()=>X,registerRuntimeCompiler:()=>Q}),function(e){e[e.ELEMENT=1]="ELEMENT",e[e.STATEFUL_COMPONENT=4]="STATEFUL_COMPONENT",e[e.TEXT_CHILDREN=8]="TEXT_CHILDREN",e[e.ARRAY_CHILDREN=16]="ARRAY_CHILDREN",e[e.SLOTS_CHILDREN=32]="SLOTS_CHILDREN"}(t||(t={}));const r=e=>"string"==typeof e,c=/-(\w)/g,l=/\B([A-Z])/g,s=e=>e?`on${(e=>e.charAt(0).toUpperCase()+e.slice(1))(e)}`:"";function i(e,n){return Object.prototype.hasOwnProperty.call(e,n)}const u=Object.assign,f=e=>null!==e&&"object"==typeof e,a=function(e,n,t){const o={el:null,component:null,key:null==n?void 0:n.key,type:e,props:n||{},children:t,shapeFlag:g(e)};return Array.isArray(t)?o.shapeFlag|=16:"string"==typeof t&&(o.shapeFlag|=8),function(e,n){"object"==typeof n&&(1&e.shapeFlag||(e.shapeFlag|=32))}(o,t),o},p=Symbol("Text"),h=Symbol("Fragment");function d(e){return"string"==typeof e||"number"==typeof e?a(p,null,String(e)):e}function g(e){return"string"==typeof e?1:4}const y=(e,n=null,t=[])=>a(e,n,t),m=e=>Array.isArray(e)?e:[e];function v(e,n,...t){const o=e.props;let r=o[s((i=n,i.replace(c,((e,n)=>n?n.toUpperCase():""))))];var i;r||(r=o[s((e=>e.replace(l,"-$1").toLowerCase())(n))]),r&&r(...t)}const E={$el:e=>e.vnode.el,$emit:e=>e.emit,$slots:e=>e.slots,$props:e=>e.props},_={get({_:e},n){const{setupState:t,props:o}=e;if(console.log(`触发 proxy hook , key -> : ${n}`),"$"!==n[0]){if(i(t,n))return t[n];if(i(o,n))return o[n]}const r=E[n];if(r)return r(e)},set({_:e},n,t){const{setupState:o}=e;return o!=={}&&i(o,n)&&(o[n]=t),!0}};function T(e){return new Set(e)}let $,b=!1;const N=new WeakMap;class k{constructor(e,n){this.fn=e,this.scheduler=n,this.active=!0,this.deps=[],console.log("创建 ReactiveEffect 对象")}run(){if(console.log("run"),!this.active)return this.fn();b=!0,$=this,console.log("执行用户传入的 fn");const e=this.fn();return b=!1,$=void 0,e}stop(){var e;this.active&&((e=this).deps.forEach((n=>{n.delete(e)})),e.deps.length=0,this.onStop&&this.onStop(),this.active=!1)}}function S(e){e.has($)||(e.add($),$.deps.push(e))}function x(){return b&&void 0!==$}function w(e){for(const n of e)n.scheduler?n.scheduler():n.run()}const O=C(),R=C(!0),M=C(!0,!0);function C(e=!1,n=!1){return function(t,o,r){if("__v_isReactive"===o)return!e;if("__v_isReadonly"===o)return e;if("__v_raw"===o&&r===I.get(t)||"__v_raw"===o&&r===j.get(t)||"__v_raw"===o&&r===F.get(t))return t;const c=Reflect.get(t,o,r);return e||function(e,n,t){if(!x())return;console.log(`触发 track -> target: ${e} type:get key:${t}`);let o=N.get(e);o||(o=new Map,N.set(e,o));let r=o.get(t);r||(r=T(),o.set(t,r)),S(r)}(t,0,o),n?c:f(c)?e?function(e){return H(e,j,L)}(c):V(c):c}}const L={get:R,set:(e,n)=>(console.warn(`Set operation on key "${String(n)}" failed: target is readonly.`,e),!0)},P={get:O,set:function(e,n,t,o){const r=Reflect.set(e,n,t,o);return function(e,n,t){let o=[];const r=N.get(e);if(!r)return;const c=r.get(t);o.push(c);const l=[];o.forEach((e=>{l.push(...e)})),w(T(l))}(e,0,n),r}},A={get:M,set:(e,n)=>(console.warn(`Set operation on key "${String(n)}" failed: target is readonly.`,e),!0)},I=new WeakMap,j=new WeakMap,F=new WeakMap;var D;function V(e){return H(e,I,P)}function H(e,n,t){const o=n.get(e);if(o)return o;const r=new Proxy(e,t);return n.set(e,r),r}!function(e){e.IS_REACTIVE="__v_isReactive",e.IS_READONLY="__v_isReadonly",e.RAW="__v_raw"}(D||(D={}));class U{constructor(e){this.__v_isRef=!0,this._rawValue=e,this._value=W(e),this.dep=T()}get value(){return function(e){x()&&S(e.dep)}(this),this._value}set value(e){var n,t;n=e,t=this._rawValue,Object.is(n,t)||(this._value=W(e),this._rawValue=e,function(e){w(e.dep)}(this))}}function X(e){return function(e){return new U(e)}(e)}function W(e){return f(e)?V(e):e}const B={get:(e,n,t)=>function(e){return Y(e)?e.value:e}(Reflect.get(e,n,t)),set:(e,n,t,o)=>Y(e[n])&&!Y(t)?e[n].value=t:Reflect.set(e,n,t,o)};function Y(e){return!!e.__v_isRef}function z(e){const{props:n,children:t}=e.vnode;!function(e,n){console.log("initProps"),e.props=n}(e,n),function(e,n){const{vnode:t}=e;console.log("初始化 slots"),32&t.shapeFlag&&((e,n)=>{for(const t in e){const o=e[t];"function"==typeof o&&(n[t]=e=>m(o(e)))}})(n,e.slots={})}(e,t),function(e){console.log("创建 proxy"),e.proxy=new Proxy(e.ctx,_);const n=e.type,{setup:t}=n;if(t){K(e);const n=function(e){return console.log("初始化 setup context"),{attrs:e.attrs,slots:e.slots,emit:e.emit,expose:()=>{}}}(e),o=t&&t(H(e.props,F,A),n);K(null),function(e,n){"function"==typeof n?e.render=n:"object"==typeof n&&(e.setupState=new Proxy(n,B)),G(e)}(e,o)}else G(e)}(e)}function G(e){const n=e.type;if(!e.render){if(q&&!n.render&&n.template){const e=n.template;n.render=q(e)}e.render=n.render}}let q,Z={};function J(){return Z}function K(e){Z=e}function Q(e){q=e}const ee=[],ne=[],te=Promise.resolve();let oe,re=!1;function ce(){let e;for(re=!1,function(){for(let e=0;e<ne.length;e++)ne[e]()}();e=ee.shift();)e&&e()}function le(e){return function(n){return{_component:n,mount(t){console.log("基于根组件创建 vnode");const o=a(n);console.log("调用 render，基于 vnode 进行开箱"),e(o,t)}}}}function se(e){const{createElement:n,setElementText:t,patchProp:o,insert:r,remove:c,setText:l,createText:s}=e,i=(e,n)=>{console.log("调用 path"),f(null,e,n)};function f(e,i,g=null,y=null,m=null){const{type:E,shapeFlag:_}=i;switch(E){case p:!function(e,n,t){if(console.log("处理 Text 节点"),null===e)console.log("初始化 Text 类型的节点"),r(n.el=s(n.children),t);else{const t=n.el=e.el;n.children!==e.children&&(console.log("更新 Text 类型的节点"),l(t,n.children))}}(e,i,g);break;case h:!function(e,n,t){e||(console.log("初始化 Fragment 类型的节点"),a(n.children,t))}(e,i,g);break;default:1&_?(console.log("处理 element"),function(e,l,s,i,u){e?function(e,n,l,s,i){const u=e&&e.props||{},a=n.props||{};console.log("应该更新 element"),console.log("旧的 vnode",e),console.log("新的 vnode",n);const p=n.el=e.el;(function(e,n,t){for(const r in t){const c=n[r],l=t[r];c!==l&&o(e,r,c,l)}for(const r in n){const c=n[r],l=null;r in t||o(e,r,c,l)}})(p,u,a),function(e,n,o,l,s){const{shapeFlag:i,children:u}=e,{shapeFlag:a,children:p}=n;8&a?p!==u&&(console.log("类型为 text_children, 当前需要更新"),t(o,p)):16&i&&16&a&&function(e,n,t,o,l){let s=0;const i=n.length;let u=e.length-1,a=i-1;const p=(e,n)=>e.type===n.type&&e.key===n.key;for(;s<=u&&s<=a;){const r=e[s],c=n[s];if(!p(r,c)){console.log("两个 child 不相等(从左往右比对)"),console.log(`prevChild:${r}`),console.log(`nextChild:${c}`);break}console.log("两个 child 相等，接下来对比这两个 child 节点(从左往右比对)"),f(r,c,t,o,l),s++}for(;s<=u&&s<=a;){const r=e[u],c=n[a];if(!p(r,c)){console.log("两个 child 不相等(从右往左比对)"),console.log(`prevChild:${r}`),console.log(`nextChild:${c}`);break}console.log("两个 child 相等，接下来对比这两个 child 节点(从右往左比对)"),f(r,c,t,o,l),u--,a--}if(s>u&&s<=a){const e=a+1,r=e<i?n[e].el:o;for(;s<=a;)console.log(`需要新创建一个 vnode: ${n[s].key}`),f(null,n[s],t,r,l),s++}else if(s>a&&s<=u)for(;s<=u;)console.log(`需要删除当前的 vnode: ${e[s].key}`),c(e[s].el),s++;else{let h=s,d=s;const g=new Map;let y=!1,m=0;for(let e=d;e<=a;e++){const t=n[e];g.set(t.key,e)}const v=a-d+1;let E=0;const _=new Array(v);for(let e=0;e<v;e++)_[e]=0;for(s=h;s<=u;s++){const o=e[s];if(E>=v){c(o.el);continue}let r;if(null!=o.key)r=g.get(o.key);else for(let e=d;e<=a;e++)if(p(o,n[e])){r=e;break}void 0===r?c(o.el):(console.log("新老节点都存在"),_[r-d]=s+1,r>=m?m=r:y=!0,f(o,n[r],t,null,l),E++)}const T=y?function(e){const n=e.slice(),t=[0];let o,r,c,l,s;const i=e.length;for(o=0;o<i;o++){const i=e[o];if(0!==i){if(r=t[t.length-1],e[r]<i){n[o]=r,t.push(o);continue}for(c=0,l=t.length-1;c<l;)s=c+l>>1,e[t[s]]<i?c=s+1:l=s;i<e[t[c]]&&(c>0&&(n[o]=t[c-1]),t[c]=o)}}for(c=t.length,l=t[c-1];c-- >0;)t[c]=l,l=n[l];return t}(_):[];let $=T.length-1;for(let e=v-1;e>=0;e--){const c=d+e,s=n[c],u=c+1<i?n[c+1].el:o;0===_[e]?f(null,s,t,u,l):y&&($<0||T[$]!==e?r(s.el,t,u):$--)}}}(u,p,o,l,s)}(e,n,p,s,i)}(e,l,0,i,u):function(e,c,l){const{shapeFlag:s,props:i}=e,u=e.el=n(e.type);if(8&s?(console.log(`处理文本:${e.children}`),t(u,e.children)):16&s&&a(e.children,u),i)for(const e in i){const n=i[e];o(u,e,null,n)}console.log("vnodeHook  -> onVnodeBeforeMount"),console.log("DirectiveHook  -> beforeMount"),console.log("transition  -> beforeEnter"),r(u,c,l),console.log("vnodeHook  -> onVnodeMounted"),console.log("DirectiveHook  -> mounted"),console.log("transition  -> enter")}(l,s,i)}(e,i,g,y,m)):4&_&&(console.log("处理 component"),function(e,n,t,o){e?function(e,n,t){console.log("更新组件",e,n);const o=n.component=e.component;!function(e,n){const{props:t}=e,{props:o}=n;return t!==o&&(t?!o||function(e,n){const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!0;for(let o=0;o<t.length;o++){const r=t[o];if(n[r]!==e[r])return!0}return!1}(t,o):!!o)}(e,n)?(console.log(`组件不需要更新: ${o}`),n.component=e.component,n.el=e.el,o.vnode=n):(console.log(`组件需要更新: ${o}`),o.next=n,o.update())}(e,n):function(e,n,t){const o=e.component=function(e,n){const t={type:e.type,vnode:e,next:null,props:{},parent:n,provides:n?n.provides:{},proxy:null,isMounted:!1,attrs:{},slots:{},ctx:{},setupState:{},emit:()=>{}};return t.ctx={_:t},t.emit=v.bind(null,t),t}(e,t);console.log(`创建组件实例:${o.type.name}`),z(o),function(e,n,t){e.update=function(e,n={}){const t=new k(e);u(t,n),t.run();const o=t.run.bind(t);return o.effect=t,o}((function(){if(e.isMounted){console.log(`${e.type.name}:调用更新逻辑`);const{next:n,vnode:t}=e;n&&(n.el=t.el,function(e,n){n.component=e,e.vnode=n,e.next=null;const{props:t}=n;console.log("更新组件的 props",t),e.props=t,console.log("更新组件的 slots")}(e,n));const o=e.proxy,r=d(e.render.call(o,o)),c=e.subTree;e.subTree=r,console.log(`${e.type.name}:触发 beforeUpdated hook`),console.log(`${e.type.name}:触发 onVnodeBeforeUpdate hook`),f(c,r,c.el,null,e),console.log(`${e.type.name}:触发 updated hook`),console.log(`${e.type.name}:触发 onVnodeUpdated hook`)}else{console.log(`${e.type.name}:调用 render,获取 subTree`);const o=e.proxy,r=e.subTree=d(e.render.call(o,o));console.log("subTree",r),console.log(`${e.type.name}:触发 beforeMount hook`),console.log(`${e.type.name}:触发 onVnodeBeforeMount hook`),f(null,r,t,null,e),n.el=r.el,console.log(`${e.type.name}:触发 mounted hook`),e.isMounted=!0}}),{scheduler:()=>{var n,t;n=e.update,ee.includes(n)||(ee.push(n),re||(re=!0,(t=ce)&&te.then(t)))}})}(o,e,n)}(n,t,o)}(e,i,g,m))}}function a(e,n){e.forEach((e=>{console.log("mountChildren:",e),f(null,e,n)}))}return{render:i,createApp:le(i)}}function ie(e){return console.log("CreateElement",e),document.createElement(e)}function ue(e){return document.createTextNode(e)}function fe(e,n){e.nodeValue=n}function ae(e,n){console.log("SetElementText",e,n),e.textContent=n}function pe(e,n,t,o){if(console.log(`PatchProp 设置属性:${n} 值:${o}`),console.log(`key: ${n} 之前的值是:${t}`),(e=>/^on[A-Z]/.test(e))(n)){const t=e._vei||(e._vei={}),r=t[n];if(o&&r)r.value=o;else{const c=n.slice(2).toLowerCase();if(o){const r=t[n]=o;e.addEventListener(c,r)}else e.removeEventListener(c,r),t[n]=void 0}}else null===o||""===o?e.removeAttribute(n):e.setAttribute(n,o)}function he(e,n,t=null){console.log("Insert"),n.insertBefore(e,t)}function de(e){const n=e.parentNode;n&&n.removeChild(e)}const ge=(...e)=>(oe||(oe=se({createElement:ie,createText:ue,setText:fe,setElementText:ae,patchProp:pe,insert:he,remove:de}))).createApp(...e),ye=Symbol("toDisplayString"),me=Symbol("createElementVNode"),ve={[ye]:"toDisplayString",[me]:"createElementVNode"};function Ee(e,n={}){const t=function(e,{runtimeModuleName:n="vue",runtimeGlobalName:t="Vue",mode:o="function"}){const r={code:"",mode:o,runtimeModuleName:n,runtimeGlobalName:t,helper:e=>`_${ve[e]}`,push(e){r.code+=e},newline(){r.code+="\n"}};return r}(0,n),{push:o,mode:r}=t;return"module"===r?function(e,n){const{push:t,newline:o,runtimeModuleName:r}=n;e.helpers.length&&t(`import {${e.helpers.map((e=>`${ve[e]} as _${ve[e]}`)).join(", ")} } from ${JSON.stringify(r)}`),o(),t("export ")}(e,t):function(e,n){const{runtimeGlobalName:t,push:o,newline:r}=n,c=t;e.helpers.length>0&&o(`\n          const { ${e.helpers.map((e=>`${ve[e]} : _${ve[e]}`)).join(", ")}} = ${c} \n  \n        `),r(),o("return ")}(e,t),o(`function render(${["_ctx"].join(", ")}) {`),o("return "),_e(e.codegenNode,t),o("}"),{code:t.code}}function _e(e,n){switch(e.type){case 2:!function(e,n){const{push:t,helper:o}=n;t(`${o(ye)}(`),_e(e.content,n),t(")")}(e,n);break;case 3:!function(e,n){n.push(e.content,e)}(e,n);break;case 4:!function(e,n){const{push:t,helper:o}=n,{tag:c,props:l,children:s}=e;t(`${o(me)}(`),function(e,n){const{push:t}=n;for(let o=0;o<e.length;o++){const c=e[o];r(c)?t(`${c}`):_e(c,n),o<e.length-1&&t(", ")}}(function(e){let n=e.length;for(;n--&&null==e[n];);return e.slice(0,n+1).map((e=>e||"null"))}([c,l,s]),n),t(")")}(e,n);break;case 5:!function(e,n){const{push:t}=n;for(let o=0;o<e.children.length;o++){const c=e.children[o];r(c)?t(c):_e(c,n)}}(e,n);break;case 0:!function(e,n){const{push:t}=n;t(`'${e.content}'`)}(e,n)}}var Te,$e,be;function Ne(e,n){console.log("开始解析 children");const t=[];for(;!ke(e,n);){let o;const r=e.source;if(Le(r,"{{"))o=Oe(e);else if("<"===r[0])if("/"===r[1]){if(/[a-z]/i.test(r[2])){we(e,1);continue}}else/[a-z]/i.test(r[1])&&(o=Se(e,n));o||(o=Re(e)),t.push(o)}return t}function ke(e,n){const t=e.source;if(e.source.startsWith("</"))for(let e=n.length-1;e>=0;--e)if(xe(t,n[e].tag))return!0;return!e.source}function Se(e,n){const t=we(e,0);n.push(t);const o=Ne(e,n);if(n.pop(),!xe(e.source,t.tag))throw new Error(`缺失结束标签：${t.tag}`);return we(e,1),t.children=o,t}function xe(e,n){return Le(e,"</")&&e.slice(2,2+n.length).toLowerCase()===n.toLowerCase()}function we(e,n){const t=/^<\/?([a-z][^\r\n\t\f />]*)/i.exec(e.source),o=t[1];if(Ce(e,t[0].length),Ce(e,1),1!==n)return{type:4,tag:o,tagType:0}}function Oe(e){const n=e.source.indexOf("}}","{{".length);Ce(e,2);const t=n-"{{".length,o=e.source.slice(0,t),r=Me(e,o.length).trim();return Ce(e,"}}".length),{type:2,content:{type:3,content:r}}}function Re(e){console.log("解析 text",e);const n=["<","{{"];let t=e.source.length;for(let o=0;o<n.length;o++){const r=e.source.indexOf(n[o]);-1!==r&&t>r&&(t=r)}return{type:0,content:Me(e,t)}}function Me(e,n){console.log("解析 textData");const t=e.source.slice(0,n);return Ce(e,n),t}function Ce(e,n){console.log("推进代码",e,n),e.source=e.source.slice(n)}function Le(e,n){return e.startsWith(n)}function Pe(e,n={}){const t=function(e,n){const t={root:e,nodeTransforms:n.nodeTransforms||[],helpers:new Map,helper(e){const n=t.helpers.get(e)||0;t.helpers.set(e,n+1)}};return t}(e,n);Ae(e,t),function(e,n){const{children:t}=e,o=t[0];if(4===o.type&&o.codegenNode){const n=o.codegenNode;e.codegenNode=n}else e.codegenNode=o}(e),e.helpers.push(...t.helpers.keys())}function Ae(e,n){const t=e.type,o=n.nodeTransforms,r=[];for(let t=0;t<o.length;t++){const c=(0,o[t])(e,n);c&&r.push(c)}switch(t){case 2:n.helper(ye);break;case 1:case 4:!function(e,n){e.children.forEach((e=>{Ae(e,n)}))}(e,n)}let c=r.length;for(;c--;)r[c]()}function Ie(e){2===e.type&&(e.content=function(e){return e.content=`_ctx.${e.content}`,e}(e.content))}function je(e,n){if(4===e.type)return()=>{const t=`'${e.tag}'`;let o=null;e.children.length>0&&1===e.children.length&&(o=e.children[0]),e.codegenNode=function(e,n,t,o){return e&&e.helper(me),{type:4,tag:n,props:null,children:o}}(n,t,0,o)}}function Fe(e){return 2===e.type||0===e.type}function De(e,n){if(4===e.type)return()=>{const n=e.children;let t;for(let e=0;e<n.length;e++){const o=n[e];if(Fe(o))for(let r=e+1;r<n.length;r++){const c=n[r];if(!Fe(c)){t=void 0;break}t||(t=n[e]={type:5,loc:o.loc,children:[o]}),t.children.push(" + ",c),n.splice(r,1),r--}}}}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(Te||(Te={})),function(e){e[e.TEXT=0]="TEXT",e[e.ROOT=1]="ROOT",e[e.INTERPOLATION=2]="INTERPOLATION",e[e.SIMPLE_EXPRESSION=3]="SIMPLE_EXPRESSION",e[e.ELEMENT=4]="ELEMENT",e[e.COMPOUND_EXPRESSION=5]="COMPOUND_EXPRESSION"}($e||($e={})),function(e){e[e.ELEMENT=0]="ELEMENT"}(be||(be={})),Q((function(e,n={}){const{code:t}=function(e,n){const t=function(e){const n=function(e){return console.log("创建 paserContext"),{source:e}}(e);return{type:1,children:Ne(n,[]),helpers:[]}}(e);return Pe(t,Object.assign(n,{nodeTransforms:[je,De,Ie]})),Ee(t)}(e,n);return new Function("Vue",t)(o)}));var Ve=n.ri,He=n.Us,Ue=n.FN,Xe=n.h,We=n.qj,Be=n.iH,Ye=n.Y1;export{Ve as createApp,He as createRenderer,Ue as getCurrentInstance,Xe as h,We as reactive,Be as ref,Ye as registerRuntimeCompiler};